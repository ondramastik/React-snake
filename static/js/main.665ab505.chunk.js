(this["webpackJsonpreact-snake"]=this["webpackJsonpreact-snake"]||[]).push([[0],{26:function(e,t,n){},52:function(e,t,n){"use strict";n.r(t);var i,o,r=n(0),a=n.n(r),s=n(21),c=n.n(s),u=n(3),l=n(8),h=n(5),d=n(6);!function(e){e[e.Top=0]="Top",e[e.Down=1]="Down",e[e.Left=2]="Left",e[e.Right=3]="Right"}(i||(i={})),function(e){e[e.Empty=0]="Empty",e[e.Floor=1]="Floor",e[e.Wall=2]="Wall",e[e.Snake=3]="Snake",e[e.Food=4]="Food"}(o||(o={}));var f=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;Object(h.a)(this,e),this._map=void 0,this.foodLocation=void 0,this.snakeTiles=void 0,this.score=0,this.tickNumber=0,this.error=!1,this.errorCause=void 0,this.speed=void 0,this.prevDirection=void 0,this.eatingAudio=new Audio("/React-snake/resources/audio/eating.wav"),this.deathAudio=new Audio("/React-snake/resources/audio/death.mp3"),this._map=t,this.prevDirection=t.startDirection,this.foodLocation=e.generateFoodLocation(t.tiles),this.snakeTiles=[Object(l.a)({},t.startLocation)],this.speed=n,this.eatingAudio.load(),this.deathAudio.load()}return Object(d.a)(e,[{key:"getMap",value:function(){return this._map}},{key:"tick",value:function(t){var n=this;return new Promise((function(i,o){try{var r=e.isValidDirection(n.prevDirection,t),a=void 0!==t&&r?t:n.prevDirection,s=n.handleTick(a);n.prevDirection=a,i(s)}catch(c){n.error=!0,n.errorCause=c.message,n.deathAudio.play(),o(c)}}))}},{key:"reset",value:function(){return this.snakeTiles=[Object(l.a)({},this._map.startLocation)],this.foodLocation=e.generateFoodLocation(this._map.tiles),this.score=0,this.tickNumber=0,this.error=!1,this.errorCause=void 0,Promise.resolve(this.getGameMeta())}},{key:"getErrorCause",value:function(){return this.errorCause}},{key:"getScore",value:function(){return this.score}},{key:"getTickNumber",value:function(){return this.tickNumber}},{key:"hasError",value:function(){return this.error}},{key:"handleTick",value:function(t){var n=this.snakeTiles[this.snakeTiles.length-1],o=Object(l.a)({},n);switch(t){case i.Top:o.X-=1;break;case i.Down:o.X+=1;break;case i.Left:o.Y-=1;break;case i.Right:o.Y+=1}return this.validate(o),this.snakeTiles.push(o),this.foodLocation.X===o.X&&this.foodLocation.Y===o.Y?(this.eatingAudio.play(),this.foodLocation=e.generateFoodLocation(this._map.tiles),this.score+=this.speed):this.snakeTiles.shift(),this.getGameMeta()}},{key:"getGameMeta",value:function(){return{snakeTiles:this.snakeTiles,foodLocation:this.foodLocation,nextTickIn:25*(11-this.speed)}}},{key:"validate",value:function(e){if(!this._map.tiles[e.X][e.Y])throw Error("Player out of field");if(![o.Floor,o.Food].includes(this._map.tiles[e.X][e.Y]))throw Error("Player crashed");if(this.snakeTiles.filter((function(t){return t.X===e.X&&t.Y===e.Y})).length>0)throw Error("The player ate himself")}}],[{key:"generateFoodLocation",value:function(t){for(var n=-1;;){var i=e.randomIndex(t.length);if(void 0!==t[i]&&t[i].includes(o.Floor)){n=i;break}}for(var r=-1;;){var a=e.randomIndex(t[n].length);if(void 0!==t[n][a]&&t[n][a]===o.Floor){r=a;break}}return{X:n,Y:r}}},{key:"randomIndex",value:function(e){return Math.floor(Math.random()*e)}},{key:"isValidDirection",value:function(e,t){switch(t){case i.Left:if(e===i.Right)return!1;break;case i.Top:if(e===i.Down)return!1;break;case i.Right:if(e===i.Left)return!1;break;case i.Down:if(e===i.Top)return!1}return!0}}]),e}(),k=function(){function e(){Object(h.a)(this,e)}return Object(d.a)(e,[{key:"getMap",value:function(){return{}}},{key:"tick",value:function(e){return Promise.resolve({tiles:[],snakeTiles:[],foodLocation:{X:1,Y:1},nextTickIn:50})}},{key:"reset",value:function(){return Promise.resolve({tiles:[],snakeTiles:[],foodLocation:{X:1,Y:1},nextTickIn:50})}},{key:"getErrorCause",value:function(){}},{key:"getScore",value:function(){return 0}},{key:"getTickNumber",value:function(){return 0}},{key:"hasError",value:function(){return!1}}]),e}(),v=a.a.createContext(new k),b=(n(26),n(1)),j=function(e){var t=e.gameMap,n=e.gameMeta;return Object(b.jsxs)("div",{id:"game-field-presenter",style:{position:"relative"},children:[t.tiles.map((function(e,n){return Object(b.jsxs)(a.a.Fragment,{children:[e.map((function(e,i){return Object(b.jsx)("div",{className:"tile tile-".concat(t.tiles[n][i])},"".concat(n,"-").concat(i))})),Object(b.jsx)("div",{})]})})),Object(b.jsx)("div",{style:{position:"absolute",top:20*n.foodLocation.X,left:20*n.foodLocation.Y},className:"tile tile-".concat(o.Food)}),n.snakeTiles.map((function(e){return Object(b.jsx)("div",{style:{position:"absolute",top:20*e.X,left:20*e.Y},className:"tile tile-".concat(o.Snake)},"snake-".concat(e.X,"-").concat(e.Y))}))]})},p=function(){var e=Object(r.useContext)(v),t=Object(r.useState)(),n=Object(u.a)(t,2),o=n[0],a=n[1],s=Object(r.useState)(!0),c=Object(u.a)(s,2),l=c[0],h=c[1],d=Object(r.useState)(),f=Object(u.a)(d,2),k=f[0],p=f[1],m=Object(r.useState)(!1),g=Object(u.a)(m,2),O=g[0],y=g[1],T=Object(r.useCallback)((function(){e.reset().then((function(e){return a(e)})),h(!0),p(void 0),y(!1)}),[e]);return Object(r.useEffect)((function(){document.addEventListener("keydown",(function(e){var t=void 0;switch(e.code){case"ArrowLeft":t=i.Left;break;case"ArrowUp":t=i.Top;break;case"ArrowRight":t=i.Right;break;case"ArrowDown":t=i.Down;break;case"Space":T()}void 0!==t&&p(t)}))}),[T]),Object(r.useEffect)((function(){l&&!O&&(y(!0),e.tick(k).then((function(e){return setTimeout((function(){return a(e)}),e.nextTickIn)})).then((function(){return y(!1)})).catch((function(){h(!1)})))}),[o]),Object(b.jsxs)("div",{id:"game",children:[Object(b.jsxs)("h1",{children:["Score: ",e.getScore()]}),e.hasError()&&Object(b.jsxs)("h1",{children:["Error: ",e.getErrorCause()]}),o&&Object(b.jsx)(j,{gameMap:e.getMap(),gameMeta:o}),Object(b.jsx)("button",{onClick:function(){return T()},disabled:l,children:"Restart"})]})},m=a.a.createContext({}),g=n(11),O=n.n(g),y=function(){function e(){Object(h.a)(this,e)}return Object(d.a)(e,[{key:"list",value:function(){return O.a.get("/React-snake/resources/maps/maplist.json").then((function(e){return e.data}))}},{key:"load",value:function(e){return O.a.get("/React-snake/resources/maps/".concat(e,".json")).then((function(e){return e.data}))}}]),e}();var T=function(){var e=Object(r.useState)(new y),t=Object(u.a)(e,1)[0],n=Object(r.useState)(),o=Object(u.a)(n,2),a=o[0],s=o[1];return Object(r.useEffect)((function(){a||t.load("map1").then((function(e){return s(new f({tiles:e,startLocation:{X:1,Y:1},startDirection:i.Down}))}))})),Object(b.jsx)("div",{className:"App",children:a&&Object(b.jsx)(v.Provider,{value:a,children:Object(b.jsx)(m.Provider,{value:t,children:Object(b.jsx)(p,{})})})})},L=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,53)).then((function(t){var n=t.getCLS,i=t.getFID,o=t.getFCP,r=t.getLCP,a=t.getTTFB;n(e),i(e),o(e),r(e),a(e)}))};c.a.render(Object(b.jsx)(a.a.StrictMode,{children:Object(b.jsx)(T,{})}),document.getElementById("root")),L()}},[[52,1,2]]]);
//# sourceMappingURL=main.665ab505.chunk.js.map